---
id: 1
projectName: 소파
description:
 사이드 프로젝트, 스터디 팀원 매칭 사이트입니다. framer-motion을 사용하여 인터랙티브한 애니메이션을 구현하였습니다. 현재 약 30명의 유저가 가입 중이며 각종 개발 커뮤니티를 통해 홍보 중에 있습니다.


 프로젝트 파트너를 찾고 싶었지만 비전공자라서, 개발 인맥이 좁아서, 등등 갖가지 이유로 구하기 어려웠습니다. 따라서 직접 프로젝트 파트너 사이트를 만들게 되었습니다. 몇몇 프로젝트 파트너 매칭 사이트가 있었지만 저만의 인터랙티브한 사이트를 만들고 싶었고 같은 고민을 안고 계신 개발자 혹은 개발자 지망생분들의 고민을 덜어드리고자 제작하게 되었습니다!
link: https://sopa.life
skills: [
    nextjs,
    tailwindcss,
    typescript,
    recoil,
    graphql
]
whatILearned: [
    {
        id: 1,
        title: 서버측에서 가져온 데이터와 클라이언트 측 Apollo Cache 동기화,
        content: 
        1) 로직 

         현재 소파의 프론트엔드는 Next로 백엔드는 Apollo로 구현되어 있습니다. 관심버튼을 누르면 Mutation처리 후 즉각적인 cache 수정을 통해 게시글의 관심의 개수가 +1이 되도록 로직을 구성했고 Next가 제공하는 getServerSideProps에서 query요청을 보내는 작업 즉 SSR로 게시글 데이터를 요청한 후 pageProps를 통해 클라이언트 쪽으로 넘기는 작업이 있었습니다. 
        

        2) 문제 

         그런데 왜인지 이렇게 가져온 게시글 데이터에 관심버튼을 눌러도 Mutation요청은 가지만 Cache가 즉각적으로 수정되지 않았습니다. 앱이 렌더링 되었을 때 SSR로 가져온 게시글 데이터의 관심버튼을 누른다고 해도 클라이언트의 Apollo Cache에 반영되지 않는다는 것만 알 뿐 그 이유를 못 찾아 하루를 꼬박 샌 적이 있습니다. 스택오버플로우와 구글링을 통해 결국 알아낸 점은 SSR로 가져온 데이터와 클라이언트 측의 Apollo Cache는 동기화가 되지 않은 상태란 것이었습니다. 따라서 SSR로 가져온 데이터에 관심버튼을 누른다고 해도 즉각적인 Cache수정은 일어나지 않는 것이었습니다.
        

        3) 해결

         그렇다고 SSR을 통한 SEO개선과 빠른 첫 화면 제공의 장점을 포기할 수도 유저가 인터랙티브함을 느낄 수 있는 Cache조작을 포기할 수도 없는 노릇이었습니다. SSR으로 가져온 데이터와 클라이언트의 Apollo Cache를 동기화시킬 방법을 몇 시간동안 고민한 결과 나온 해결책은 SSR로 게시글 데이터를 query 요청을 해서 가져오되 그 데이터가 아닌! SSR로 데이터를 처리한 후 생긴 Cache를 extract하여 클라이언트 측으로 보내주고 pageProps로 이를 받아 클라이언트 쪽에서 자신의 Cache로 restore 시키는 방법이었습니다. 다행히 Cache간 동기화가 되어 정상 작동되었고 2~3일을 매달려 해결한 문제였기에 뇌리에서 잊혀지지 않는 이슈였습니다.
    },
    {
        id: 2,
        title: 컴포넌트 메모이징,
        content: 
        1) 문제 

        게시글의 댓글 기능을 구현하던 중 마주한 문제였습니다. 게시글에 댓글을 추가하면 게시글에 현재 달린 댓글의 개수만큼 리렌더링이 일어났습니다. 우연찮게 작성했던 콘솔로그로 확인하여 무언가 이상함을 감지했고 로컬환경이었지만 댓글이 20개나 되는 게시글이었기에 콘솔창에는 다수의 로그가 찍혀서 개선이 반드시 필요함을 느꼈습니다. 
        

        2) 해결 

         이번 이슈는 구글링 전에 한 번 생각해보았습니다. 왜 건드리지도 않은 다른 댓글에 리렌더링이 일어나는지 생각해본 결과 댓글이 추가되어 comments에 변화가 생기면 게시글을 보여주는 부모 컴포넌트에 영향이 가고 그 여파로 자식 컴포넌트 소속인 모든 댓글들이 리렌더링이 일어나는 것이었습니다. 이 때 사용할 만한 기술이 메모이징이라는 것은 이론으로는 알고 있었지만 최적화 관련 코드 개선은 경험이 적었기에 구글링을 한 결과 컴포넌트 자체를 메모이징 할 수 있는 React.memo를 적용하였습니다. prop에 변화가 생기지 않는 댓글 컴포넌트들은 더이상 리렌더링이 되지 않았고 생각대로 콘솔로그는 추가된 댓글에 관해서만 찍히는 것을 확인하였습니다.
         

        3) 느낀 점

         제가 이 경험이 좋았던 점은 개발자라면 에러나 버그는 숱하게 잡는 것이지만 이렇게 정상 작동하는 코드를 더 좋은 방향으로 개선하는 시도는 그렇게 많지 않았었기 때문입니다. 이 것을 계기로 최적화에 조금 더 관심을 갖게 되어 소파 사이트에 Next의 dynamic을 활용하여 유저가 현재 보고 있지 않은 컴포넌트는 코드의 다운을 실시하지 않게 하는 등 추가적인 최적화 작업을 하게 되었습니다.
    }
]
duration: 22.02.04 ~ 22.03.06
velog: https://velog.io/@db970406/%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%ED%8C%8C%ED%8A%B8%EB%84%88-%EB%A7%A4%EC%B9%AD-%EC%82%AC%EC%9D%B4%ED%8A%B8-%EC%86%8C%ED%8C%8C
github: https://github.com/db970406/sopa-frontend
---